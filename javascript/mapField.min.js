function gmloaded(){initLivequery()}function initMap(){var a={zoom:16,disableDefaultUI:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:!1,draggable:!0,keyboardShortcuts:!1,scrollwheel:!0};!function(b){var c=b("#GoogleMap"),d=(c.attr("data-latfieldname"),b("input[name="+c.attr("data-latfieldname")+"]")),e=b("input[name="+c.attr("data-lonfieldname")+"]"),f=b("input[name="+c.attr("data-zoomfieldname")+"]"),g=c.attr("data-GuidePoints");""===d.val()&&d.val(0),""===e.val()&&e.val(0),""===f.val()&&f.val(2);var h=[];if("undefined"!=typeof g&&(h=JSON.parse(g)),a.center=new google.maps.LatLng(d.val(),e.val()),f.length&&(a.zoom=parseInt(f.val(),10)),map=new google.maps.Map(document.getElementById("GoogleMap"),a),bounds=new google.maps.LatLngBounds,h.length){for(var i=0,j=0,k=h.length-1;k>=0;k--){var l=h[k].latitude,m=h[k].longitude;addGuideMarker(l,m);var n=new google.maps.LatLng(l,m);i+=parseFloat(l),j+=parseFloat(m),bounds.extend(n)}if(0===d.val()&&0===e.val()){var o=h.length;new google.maps.LatLng(i/o,j/o)}map.fitBounds(bounds)}d.val()&&e.val()&&(marker=null,setMarker(a.center,!0)),google.maps.event.addListener(map,"rightclick",function(a){var b=a.latLng.lat(),c=a.latLng.lng();d.val(b),e.val(c),setMarker(a.latLng,!1),statusMessage("Location changed to "+b+","+c)}),google.maps.event.addListener(map,"zoom_changed",function(){f.length&&f.val(map.getZoom())}),google.maps.event.trigger(map,"resize"),map.setZoom(map.getZoom()),b(".ui-tabs-anchor").click(function(){google.maps.event.trigger(map,"resize");var a=b("#GoogleMap"),c=a.attr("data-usemapbounds");c?map.fitBounds(bounds):map.setCenter(marker.getPosition())})}(jQuery)}function addGuideMarker(a,b){var c=new google.maps.LatLng(a,b),d="CCCCCC",e=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+d,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),f=new google.maps.MarkerImage("//chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35)),g=new google.maps.Marker({position:c,title:"Marker",icon:e,shadow:f});g.setMap(map)}function setMarker(a,b){null!==marker?marker.setPosition(a):(marker=new google.maps.Marker({position:a,title:"Position",draggable:!0}),marker.setMap(map),google.maps.event.addListener(marker,"dragend",setCoordByMarker)),b&&map.setCenter(a)}function setCoordByMarker(a){!function(b){var c=b("#GoogleMap"),d=b("input[name="+c.attr("data-latfieldname")+"]"),e=b("input[name="+c.attr("data-lonfieldname")+"]"),f=b("input[name="+c.attr("data-zoomfieldname")+"]"),g=a.latLng.lat(),h=a.latLng.lng();d.val(g),e.val(h),setMarker(a.latLng,!0),statusMessage("Location changed to "+g+","+h),f.length&&f.val(map.getZoom()),map.setCenter(a.latLng)}(jQuery)}function searchForAddress(a){!function(b){{var c=new google.maps.Geocoder;new google.maps.ElevationService}c&&(statusMessage("Searching for:"+a),c.geocode({address:a},function(a,c){if(c==google.maps.GeocoderStatus.OK){var d=a.length;d>0?statusMessage("Places found"):0===d&&errorMessage("No places found");var e='<ul class="geocodedSearchResults">';b.each(a,function(a,c){var d=[];b.each(c.address_components,function(a,b){d.push(b.long_name)}),e=e+'<li lat="'+c.geometry.location.lat()+'" lon="'+c.geometry.location.lng()+'">'+d+"</li>"}),e+="</ul>",b("#mapSearchResults").html(e)}else errorMessage("Unable to find any geocoded results")}))}(jQuery)}function initLivequery(){!function(a){a("input[name=action_GetCoords]").livequery("click",function(){var b=a("#Form_EditForm_Location").val();return setCoordByAddress(b),!1}),a("#searchLocationButton").livequery("click",function(){var b=a("#location_search").val();return searchForAddress(b),!1}),a(".geocodedSearchResults li").livequery("click",function(){var b=a(this),c=b.attr("lat"),d=b.attr("lon"),e=b.html(),f=new google.maps.LatLng(c,d);statusMessage("Setting map to "+e),a(".geocodedSearchResults").html(""),a("#Form_EditForm_Latitude").val(c),a("#Form_EditForm_Longitude").val(d);{var g=a("#GoogleMap"),h=a("input[name="+g.attr("data-latfieldname")+"]"),i=a("input[name="+g.attr("data-lonfieldname")+"]");a("input[name="+g.attr("data-zoomfieldname")+"]")}return h.val(c),i.val(d),map.setZoom(12),setMarker(f,!0),!1}),a("#GoogleMap").livequery(function(){initMap()})}(jQuery)}var marker,bounds;!function(a){function b(){var a=document.createElement("script");a.type="text/javascript",a.src="//maps.googleapis.com/maps/api/js?sensor=false&callback=gmloaded",document.body.appendChild(a)}a(document).ready(function(){b()})}(jQuery);